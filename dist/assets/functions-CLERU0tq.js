(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=n(e);fetch(e.href,t)}})();document.addEventListener("DOMContentLoaded",function(){fetch("/header.html").then(r=>r.text()).then(r=>{const n=new DOMParser().parseFromString(r,"text/html"),c=n.querySelector("head").innerHTML;document.head.insertAdjacentHTML("beforeend",c);const e=n.querySelector("nav").outerHTML;document.getElementById("header-placeholder").innerHTML=e;const t=document.querySelector("title").textContent;t&&(document.title=t)}).catch(r=>{console.error("Error loading header:",r)})});const w={supabaseUrl:"https://jktzfzbmpmgnwcysodsg.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImprdHpmemJtcG1nbndjeXNvZHNnIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczMDA0MDA0OSwiZXhwIjoyMDQ1NjE2MDQ5fQ._zZSuukjeYz0z3xSsNSYO0Km-uQ4fTAaRCLvFdvv_P4"};async function b(){return typeof window.supabase>"u"&&await new Promise(r=>{const o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2",o.onload=r,document.head.appendChild(o)}),window.supabase.createClient(w.supabaseUrl,w.supabaseKey)}const E=b();async function v(){try{const r=await E,{data:o,error:n}=await r.from("categories").select("*");if(n){console.error("Error loading categories:",n);return}const c=document.getElementById("categories-section");o.forEach(e=>{const t=document.createElement("div");t.classList.add("category"),t.textContent=e.name,t.onclick=()=>{window.location.href=`courses.html?category_id=${e.id}`},c.appendChild(t)})}catch(r){console.error("Error:",r)}}async function C(){try{const r=await E,n=new URLSearchParams(window.location.search).get("category_id");if(!n){console.error("No category ID provided");return}const{data:c,error:e}=await r.from("courses").select("*").eq("category_id",n);if(e){console.error("Error loading courses:",e);return}const t=document.getElementById("courses-section");c.forEach(i=>{const s=document.createElement("div");s.classList.add("course");const a=document.createElement("h3");a.textContent=i.name,s.appendChild(a);const d=document.createElement("p");d.textContent=i.description,s.appendChild(d);const l=document.createElement("button");l.textContent="View Course",l.onclick=()=>{window.location.href=`course-detail.html?course_id=${i.id}`},s.appendChild(l),t.appendChild(s)})}catch(r){console.error("Error:",r)}}async function I(){const o=new URLSearchParams(window.location.search).get("course_id");if(!o){console.error("No course ID provided");return}const{data:n,error:c}=await supabase.from("courses").select("*").eq("id",o).single();if(c){console.error("Error loading course:",c);return}const e=document.getElementById("course-detail"),t=`
        <h1>${n.name}</h1>
        <div class="course-description">${n.description}</div>
        <div class="course-content">
            ${marked.parse(n.content||"")}
        </div>
    `;e.innerHTML=t,document.getElementById("ask-question").addEventListener("click",async()=>{const i=document.getElementById("user-question").value,s=document.getElementById("gpt-response");if(!i.trim()){alert("Veuillez entrer une question");return}s.innerHTML="Chargement de la réponse...";try{const{data:{session:a}}=await supabase.auth.getSession(),d={question:i,context:n==null?void 0:n.content};console.log("Sending payload:",d);const l=await fetch("https://jktzfzbmpmgnwcysodsg.supabase.co/functions/v1/ask-gpt",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a==null?void 0:a.access_token}`},body:JSON.stringify(d)}),p=await l.text();console.log("Raw response:",p);let u;try{u=JSON.parse(p)}catch{throw console.error("Failed to parse response as JSON:",p),new Error("Invalid response format from server")}if(!l.ok)throw console.error("Error response:",u),new Error(u.error||"Unknown error occurred");if(u.response)s.innerHTML=marked.parse(u.response);else throw console.error("Unexpected response format:",u),new Error("Unexpected response format from server")}catch(a){console.error("Full error:",a),s.innerHTML=`
                <div class="error-message">
                    <p>Désolé, une erreur est survenue lors de la génération de la réponse.</p>
                    <p class="error-details">${a.message}</p>
                </div>
            `}})}async function S(){const{data:r,error:o}=await supabase.rpc("get_random_questions",{limit_num:20});if(o){console.error("Error loading questions:",o);return}const n=[...new Set(r.map(s=>s.course_id))],{data:c,error:e}=await supabase.from("courses").select("*").in("id",n);if(e){console.error("Error loading courses:",e);return}const t=Object.fromEntries(c.map(s=>[s.id,s])),i=document.getElementById("quiz-container");i.innerHTML="",r.forEach((s,a)=>{const d=document.createElement("div");d.classList.add("question");const l=document.createElement("div");l.className="course-info",t[s.course_id];const p=document.createElement("p");p.className="question-text",p.textContent=`${a+1}. ${s.question}`;const u=document.createElement("div");u.className="options",s.choices.forEach((f,g)=>{const y=document.createElement("label"),h=document.createElement("input");h.type="checkbox",h.name=`q${a}`,h.value=g,y.appendChild(h),y.appendChild(document.createTextNode(` ${f}`)),u.appendChild(y)});const m=document.createElement("div");m.className="feedback",m.id=`feedback-${a}`,d.appendChild(l),d.appendChild(p),d.appendChild(u),d.appendChild(m),i.appendChild(d)}),window.quizQuestions=r}function q(){const r=window.quizQuestions;if(!r){alert("Please load the quiz first!");return}let o=0;r.forEach(async(e,t)=>{const i=Array.from(document.querySelectorAll(`input[name="q${t}"]:checked`)).map(f=>e.choices[parseInt(f.value)]),s=document.getElementById(`feedback-${t}`),a=i.sort(),d=e.reponses.sort(),l=a.length===d.length&&a.every((f,g)=>f===d[g]),{data:p,error:u}=await supabase.from("courses").select("name, description").eq("id",e.course_id).single();if(u){console.error("Error loading course:",u);return}let m=l?"✅ Correct!":`❌ Incorrect.<br>Correct answers: ${e.reponses.join(", ")}`;m+=`<div class="explanation">
            <p><strong>Explanation:</strong> ${e.explanation}</p>
        </div>`,s.innerHTML=`
            ${m}
            <div class="course-feedback">
                <h4>Related Course: ${p.name}</h4>
                <p>${p.description}</p>
                <a href="course-detail.html?course_id=${e.course_id}" class="course-link">
                    Click here to learn more about this topic
                </a>
            </div>
        `,s.className=`feedback ${l?"correct":"incorrect"}`,l&&o++});const n=o/r.length*100;let c=document.getElementById("quiz-score");c||(c=document.createElement("div"),c.id="quiz-score",document.getElementById("quiz-container").appendChild(c)),c.className="quiz-score",c.textContent=`Your score: ${n}% (${o}/${r.length} correct)`}export{C as a,S as b,I as c,v as l,q as s};
